## 一.浏览器生成消息
### 1.1 解析 URL
````
[http:] + [//] + [Web 服务器名] + [:端口号] + / + 目录名 + / ... + 文件名
  |                                        |                       |               
  v                                        +————————————v——————————+
  协议                                         表示数据源（文件）的路径名

````
### 1.2 生成 HTTP 请求消息
````
请求行 <方法><空格><URI><空格><HTTP版本>
请求头 <key>:<value>
<空行>
<请求体>
````
### 1.3 向 DNS 服务器查询 Web 服务器的 IP 地址
IP 地址由 32 比特的数字组成，包含网络号、主机号两部分，它们由附加在 IP 上的子网掩码进行区分。

*操作系统提供的 Socket 库，是用于调用网络功能的程序组件集合。*其中的域名解析器，用来向 DNS 服务器查询 IP 地址。伪码如下：
````
import Socket
ip = Socket.gethostbyname('www.test.com')
````

### 1.4 "委托"操作系统内部协议栈（TCP/IP）收发数据
收发数据的操作可大致分为4个阶段，每个阶段的操作都是使用 Socket 库“委托”协议栈来完成的：
* 创建套接字（创建阶段）
* 将管道连接到服务器端的套接字上（连接阶段）
* 收发数据（通信阶段）
* 断开管道并删除套接字（断开阶段）

## 二. 用电信号传输 TCP/IP 数据——探索协议栈和网卡
+----------------------------------------------+
|                   网络应用程序                  |
|（浏览器、邮件客户端、Web服务器、邮件服务器等）        |
|  +--------------------------- --------+       |   应用程序
|  |    Socket 库      {解析器}          |       |
|  +------------------------------------+       |
+----------------------v------------------------+

+----------------------+------------------------+
| 协议栈                                         |
|  +-------------------+ +-----------------+    |   
|  |   TCP 需要连接     | | UDP 不需要连接    |    |
|  +-------------------+ +-----------------+    |   操作系统
|  +--------------------------------------+     |
|  |  IP(传送给网络包、确定路由)              |     |
|  |     {ICMP}       {ARP}               |     |
|  +--------------------------------------+     |
+----------------------v------------------------+

+----------------------+------------------------+
|             网卡驱动程序                        |   驱动程序
+----------------------v------------------------+

+----------------------+------------------------+
|              网卡                             |   硬件
+-----------------------------------------------+


### 2.1 创建套接字
应用程序调用 socket 函数申请创建套接字，首先分配一个套接字所需的内存空间，然后向其中写入初始状态。

### 2.2 连接服务器——三次握手
连接即通信双方交换控制信息，信息分为两类：
* 头部中记录的信息
* 套接字（协议栈中的内存空间）中记录的信息

**TCP三次握手**
+--------+                  +---------+
|        | (1)ACK:0, SYN:1  |         |
|        +------------------>         |
|        |                  |         |
|        | (2)ACK:1, SYN:1  |         |
| 客户端  <------------------+  服务器  |    
|        |                  |         |
|        | (3)ACK:1, SYN:1  |         |
|        +------------------>         |
|        |                  |         |
+--------+                  +---------+

### 2.3 收发数据
通过“序号”和“ACK 号”可以确认接收方是否收到网络包。
+--------+                      +---------+
|        | (1)客户端序号的初始值   |         |
|        +---------------------->         |
|        |                      |         |
|        | (2)客户端序号          |         |
| 客户端  +---------------------->  服务器  |    
|        | (2.1)服务器的 ACK 号   |         |
|        <----------------------+         |
|        |                      |         |
|        | (3)客户端序号          |         |
|        +---------------------->         |    
|        | (3.1)服务器的 ACK 号   |         |
|        <----------------------+         |
|        |                      |         |
+--------+                      +---------+

动态调整 ACK 号等待时间，超时重发包。

滑动窗口管理数据发送和 ACK 号的操作。

#### 2.3.1 接收数据
* 1.协议栈检查收到的数据块和 TCP 头部内容，判断是否有数据丢失，没有问题则返回 ACK 号；
* 2.协议栈将数据块暂存到接收缓冲区中，并将数据块按顺序连接起来还原出原始数据
* 3.最后将数据交给应用程序

### 2.4 断开连接并删除套接字
TCP 四次挥手
+--------+                  +---------+
|        | (1)FIN:1         |         |
|        +------------------>         |
|        | (2)ACK:1         |         |
| 客户端  <------------------+  服务器  |    
|        |                  |         |
|        | (3)FIN: 1        |         |
|        <------------------+         |
|        | (4)ACK: 1        |         |
|        +------------------>         |
|        |                  |         |
+--------+                  +---------+

### 2.5 IP 与以太网的包收发操作


