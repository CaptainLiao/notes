这是部门同事的一次内部分享，听完后受益颇多，趁着记忆还算新鲜，赶紧记录一波。

# 使用 dev-tool 进行页面性能分析

## 前置概念
1.  等待事件 waiting
2.  带宽

### 延迟
客户端`client`向服务器`server`发送一个请求，到客户端接收到第一个字节的这段时间，称为等待时间（waiting）。

### 带宽
带宽表示资源的下载速度。我们常说的带宽 2M，其实指的是带宽为 2M/s，表示每秒可下载 2M 的网络资源。

## 时间去哪儿

### 从`Connection Start`到`Content Download`
![](https://images2018.cnblogs.com/blog/1085489/201804/1085489-20180408174731802-1839510318.png)

图示请求并得到一个网络资源/文件的过程、及时间。名词解释：
* Queueing. 浏览器在以下事件发生时产生排队请求：
  + 有更高优先级权限的请求
  + 已经打开 6 个同源限制的 TCP 链接
  + 浏览器会短暂分配磁盘缓存中的空间
* Stalled.阻塞。 当产生Queueing 时，请求会被阻塞。
* DNS Lookup. DNS 查询。浏览器正在查询请求的 IP 地址。
* Proxy negotiation.浏览器正在和代理服务器协商请求。
* Request sent。开始发送请求。
* Waiting(TTFB).浏览器正在等待响应的第一个字节。TTFB表示`Time To First Byte`。它包括1次往返延迟的时间和服务端准备响应的时间。
* Content Download.浏览器正在接收响应。

### 页面解析时间
当一个`.html`文件被下载下来后，会触发`finish loading`事件。
![](https://images2018.cnblogs.com/blog/1085489/201804/1085489-20180408182316908-96427291.png)

然后，浏览器开始对页面进行`parse`。解析过程是从上到下依次进行，遇到`<link>`和`<script>`标签要额外注意。
* 遇到`link`，发送请求，无需等待响应，立即向下解析
* 遇到`script`，发送请求并等待响应(如果有的话)，脚本数据准备好后，判断是否在`script`之前存在`link`
  * 存在——等待`link`响应完成，执行脚本，然后向下解析
  * 不存在——执行脚本，继续向下解析

记住：**`link`标签不会阻塞页面的解析过程；`script`标签会阻塞页面解析，且阻塞时间为以下因素的叠加：1、之前未完成的`link`请求—响应时间(若无则为0)；2、`script`本身的请求-响应时间(若无src属性则为0)；3、脚本的运行时间。**

